# DevOps Project - Part 3 - Jenkins & Snyk

## Course Info

- Course Number: 605.609.81 
- Course Title: DevOps Software Development Paradigm
- Semester: Summer 2020
- Instructors: Mr. Ross Young, Mr. Jeff Garonzik
- Grader: Mr. Jason Chavez


## Team Info

### Team #: 5

### Team Members:

- Jeremy Martin (jmart204@jh.edu)
- Raymond Liu (rliu30@jhu.edu)
- Lisa Maszkiewicz (lmaszki2@jhu.edu)

## Part 3 Description

Automate scanning of OWASP Juice Shop Docker Image hosted in the GitLab Container Registry with a Jenkins Pipeline that invokes Snyk anytime code is committed to the GitLab repository.

## File Descriptions

- `Dockerfile`
    - Creates a custom Docker Image for Jenkins that installs the `docker-ce-cli` package that allows Snyk to run the `docker` command from inside the Jenkins container 
    - We tag this image with `jenkins:devops`
    - Invoke with `docker build -t jenkins:devops .`
- `docker-compose.yml`
    - Declares the GitLab and Jenkins containers with appropriate port-mappings and volume mounts
    - Note for the Jenkins container we are using the custom Jenkins image generated by the `Dockerfile` above (tagged `jenkins:devops`)
    - Note for the Jenkins container we are mounting the `/var/run/docker.sock` docker socket so that when the `docker` command is run from inside the container, it uses the host's Docker Daemon
    - Invoke with `docker-compose up -d`
- `gitlab.rb`
    - Configures GitLab to expose the GitLab Container Registry on port `5555`
    - Invoked when GitLab is started
- `daemon.json`
    - Configuration file for the host's Docker daemon that defines the GitLab container registry as an insecure registry and instructs the docker daemon to trust the GitLab container registry
    - Lives under `/etc/docker/daemon.json`
    - Invoked when the docker daemon is started


## Overall Demonstration Flow

1. Bring up the infrastructure with `docker-compose up -d`
1. Wait for `docker ps -a | grep gitlab` to return a status of "healthy"
1. Log in to the GitLab Container Registry with `docker login 100.16.0.53:5555`
1. Tag the OWASP Juice Shop Image with `docker tag juice-shop:latest 100.16.0.53:5555/rliu1/final-project-part3:latest`
1. Push the image to the GitLab Container Registry with `docker push 100.16.0.53:5555/rliu1/final-project-part3:latest` 
1. Commit a change to source code and push to GitLab
1. The GitLab Webhook invokes a new Jenkins build on the `GitLabTrigger` job
1. The Jenkins Pipeline completes the `GitLabTrigger` job and starts the `SnykScan` job
1. The `SnykScan` job scans the OWASP Juice Shop Image (tagged `100.16.0.53:5555/rliu1/final-project-part3`) with the `--docker 100.16.0.53:5555/rliu1/final-project-part3` flag configured in Jenkins
1. The build breaks because a vulnerability of severity HIGH is found
1. Snyk uploads the results to the snyk.io website
1. The scan results are viewable within at the snyk.io website